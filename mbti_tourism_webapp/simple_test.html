<!DOCTYPE html>
<html>
<head>
    <title>간단한 TourAPI 테스트</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .result { margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
        .success { background: #e7f5e7; }
        .error { background: #ffe7e7; }
        img { max-width: 200px; margin: 10px; }
    </style>
</head>
<body>
    <h1>TourAPI 연동 테스트</h1>
    <button onclick="testAPI()">API 테스트 실행</button>
    <div id="results"></div>

    <script>
        async function testAPI() {
            const results = document.getElementById('results');
            results.innerHTML = '<p>테스트 실행 중...</p>';
            
            try {
                const API_KEY = 'kHGjR8DCO8hgSNlNhiEtmkrbtYpb9XvyGNOSSjKl0h4VnkGJNqFk+F7kKrLDFEuO+M4G/ggJkUBSy5XPqJk8wA==';
                const API_URL = 'https://apis.data.go.kr/6260000/AttractionService/getAttractionKr';
                
                const params = new URLSearchParams({
                    serviceKey: decodeURIComponent(API_KEY),
                    pageNo: '1',
                    numOfRows: '10',
                    resultType: 'json'
                });
                
                console.log('API 요청 URL:', `${API_URL}?${params}`);
                
                const response = await fetch(`${API_URL}?${params}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const responseText = await response.text();
                console.log('원본 응답 텍스트:', responseText.substring(0, 500));
                
                let data;
                if (responseText.trim().startsWith('<')) {
                    // XML 응답 처리
                    console.log('XML 응답 감지, 파싱 시도...');
                    const parser = new DOMParser();
                    const xmlDoc = parser.parseFromString(responseText, 'text/xml');
                    
                    // XML에서 데이터 추출
                    const items = xmlDoc.querySelectorAll('item');
                    const parsedItems = Array.from(items).map(item => ({
                        place_nm: item.querySelector('place_nm')?.textContent,
                        addr1: item.querySelector('addr1')?.textContent,
                        itemcntnts: item.querySelector('itemcntnts')?.textContent,
                        main_img: item.querySelector('main_img')?.textContent,
                        main_img_normal: item.querySelector('main_img_normal')?.textContent,
                        main_img_thumb: item.querySelector('main_img_thumb')?.textContent
                    }));
                    
                    data = {
                        response: {
                            resultCode: xmlDoc.querySelector('resultCode')?.textContent || '00',
                            resultMsg: xmlDoc.querySelector('resultMsg')?.textContent || 'SUCCESS',
                            body: {
                                items: {
                                    item: parsedItems
                                }
                            }
                        }
                    };
                } else {
                    // JSON 응답 처리
                    data = JSON.parse(responseText);
                }
                
                console.log('파싱된 데이터:', data);
                
                let html = `<div class="result success">
                    <h3>API 연결 성공!</h3>
                    <p>응답 코드: ${data.response?.resultCode}</p>
                    <p>응답 메시지: ${data.response?.resultMsg}</p>
                </div>`;
                
                if (data.response?.body?.items?.item) {
                    const items = Array.isArray(data.response.body.items.item) 
                        ? data.response.body.items.item 
                        : [data.response.body.items.item];
                    
                    html += `<div class="result success">
                        <h3>관광지 데이터 (${items.length}개)</h3>`;
                    
                    items.slice(0, 5).forEach(item => {
                        const imageUrl = item.main_img_normal || item.main_img_thumb || item.main_img;
                        html += `
                            <div style="border-top: 1px solid #ddd; padding: 10px 0;">
                                <h4>${item.place_nm || 'N/A'}</h4>
                                <p>주소: ${item.addr1 || 'N/A'}</p>
                                <p>설명: ${(item.itemcntnts || 'N/A').substring(0, 100)}...</p>
                                ${imageUrl ? `<img src="${imageUrl}" alt="${item.place_nm}" onload="console.log('이미지 로드 성공:', this.src)" onerror="console.log('이미지 로드 실패:', this.src); this.style.display='none';">` : '<p>이미지 없음</p>'}
                                <p><small>이미지 URL: ${imageUrl || 'N/A'}</small></p>
                            </div>
                        `;
                    });
                    
                    html += '</div>';
                } else {
                    html += '<div class="result error"><h3>관광지 데이터 없음</h3></div>';
                }
                
                results.innerHTML = html;
                
            } catch (error) {
                console.error('API 에러:', error);
                results.innerHTML = `<div class="result error">
                    <h3>API 연결 실패</h3>
                    <p>에러: ${error.message}</p>
                    <p>CORS 에러일 가능성이 높습니다. 브라우저 개발자 도구의 Console 탭을 확인해주세요.</p>
                </div>`;
            }
        }
    </script>
</body>
</html>